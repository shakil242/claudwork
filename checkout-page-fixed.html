<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
      charset="utf-8"
    />

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Simple check: if page is already fully loaded, no loader needed
        if (document.readyState === 'complete') {
          return; // Page is already fully loaded, exit early
        }

        // If page is still loading, show loader until it's complete
        function getScrollbarWidth() {
          return window.innerWidth - document.documentElement.clientWidth;
        }

        function lockScroll() {
          const scrollbarWidth = getScrollbarWidth();
          document.body.style.overflow = "hidden";
          document.body.style.paddingRight = scrollbarWidth + "px";
        }

        function unlockScroll() {
          document.body.style.overflow = "unset";
          document.body.style.paddingRight = "";
        }

        function createLoader() {
          // Style block
          const style = document.createElement("style");
          style.textContent = `
              #custom-loader {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: #fff;
                z-index: 9999;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
              }

              .page-loader-spinner {
                width: 80px;
                height: 80px;
                border: 10px solid rgba(0, 0, 0, 0.1);
                border-top-color: white;
                border-radius: 50%;
                animation: pageloadspin 1s linear infinite;
                margin-bottom: 20px;
              }

              @keyframes pageloadspin {
                to { transform: rotate(360deg); }
              }
            `;
          document.head.appendChild(style);

          // Loader HTML
          const loader = document.createElement("div");
          loader.id = "custom-loader";
          loader.innerHTML = `<div class="page-loader-spinner"></div>`;
          loader.style.display = "flex";

          // Insert after #checkout-app
          document.body.insertAdjacentElement('afterend', loader);

          return loader;
        }

        function checkAllResourcesLoaded() {
          // Check if all images are loaded
          const images = document.querySelectorAll('img');
          const allImagesLoaded = Array.from(images).every(img => img.complete && img.naturalHeight !== 0);

          // Check if all stylesheets are loaded
          const stylesheets = document.querySelectorAll('link[rel="stylesheet"]');
          const allStylesLoaded = Array.from(stylesheets).every(link => {
            // Check if stylesheet is loaded by testing if it has a sheet property
            return link.sheet !== null || link.href === '';
          });

          // Check document ready state
          const documentReady = document.readyState === 'complete';

          return allImagesLoaded && allStylesLoaded && documentReady;
        }

        function waitForAllResources(loader) {
          const checkInterval = setInterval(function () {
            if (checkAllResourcesLoaded()) {
              clearInterval(checkInterval);
              setTimeout(function () {
                loader.remove();
                unlockScroll();
                document.body.style.display = '';
              }, 2500);
            }
          }, 100); // Check every 100ms

          // Fallback timeout - remove loader after 10 seconds regardless
          setTimeout(function () {
            clearInterval(checkInterval);
            loader.remove();
            unlockScroll();
            document.body.style.display = '';
          }, 10000);
        }

        // Create and show loader
        lockScroll();
        const loader = createLoader();

        // Start checking for all resources to be loaded
        waitForAllResources(loader);
      });
    </script>
    <script ecommerce-type="extend-native-history-api">
      (() => { const e = history.pushState, t = history.replaceState, a = history.back, r = history.forward; function n() { window.postMessage({ _custom_type_: "CUSTOM_ON_URL_CHANGED" }) } history.pushState = function () { e.apply(history, arguments), n() }, history.replaceState = function () { t.apply(history, arguments), n() }, history.back = function () { a.apply(history, arguments), n() }, history.forward = function () { r.apply(history, arguments), n() } })()
    </script>
    <title>TwinklingTree</title>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,600,700,800,900&amp;display=swap"
      rel="stylesheet"
      cc="true"
      as="style"
      onload="this.rel='stylesheet'"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    />
  </head>
  <body data-new-gr-c-s-check-loaded="14.1264.0" data-gr-ext-installed="">
    <!-- HTML BODY CONTENT REMAINS THE SAME -->
    <!-- Note: I'm omitting the full body HTML to focus on the JavaScript fixes -->
    <!-- The body content from your original file would go here -->

    <script>
      $(document).ready(function () {
        // When clicking the remove-text class
        $('.remove-text1').click(function () {
          // Hide the shipping-insurance-container
          $('.shipping-insurance-container').hide();
          // ✅ FIX: Added null check before clicking
          const checkbox = document.getElementById('iczym6');
          if (checkbox) {
            checkbox.click();
          } else {
            console.warn('Checkbox #iczym6 not found');
          }
        });

        // When the checkbox is clicked
        $('#iczym6').click(function () {
          // Show/hide container based on checkbox state
          if ($(this).is(':checked')) {
            $('.shipping-insurance-container').show();
          } else {
            $('.shipping-insurance-container').hide();
          }
        });
      });
    </script>

    <!-- Other scripts remain the same until we get to the fixes -->

    <script>
      function getCurrencySymbol(currencyCode) {
        const symbols = {
          USD: "$",
          CAD: "CA$",
          EUR: "€",
          AUD: "AU$",
          GBP: "£"
        };
        return symbols[currencyCode] || "$";
      }

      function applyDiscount() {
        const selectedCurrency = $("#currencyId").val();
        const currencySymbol = getCurrencySymbol(selectedCurrency);
        const discountText = $.trim($("#it2wo7").text());
        const discount = parseFloat(discountText.replace(/[^0-9.]/g, ""));
        const priceElement = $("#i91pw6");

        if (discount > 0) {
          let originalPrice = 0;
          if (!priceElement.attr("price")) {
            originalPrice = parseFloat($.trim(priceElement.text()).replace(/[^0-9.]/g, ""));
            priceElement.attr("price", originalPrice);
          } else {
            originalPrice = parseFloat(priceElement.attr("price"));
          }
          const discountedPrice = (originalPrice - discount).toFixed(2);
          priceElement.text(currencySymbol + discountedPrice);
          // ✅ FIX: Changed #iqct91 to #iqct9
          $("#ittkxs1, #iqct9").text(currencySymbol + discountedPrice);
        } else {
          if (priceElement.attr("price")) {
            const originalPrice = parseFloat(priceElement.attr("price"));
            const formattedPrice = currencySymbol + originalPrice.toFixed(2);
            // ✅ FIX: Changed #iqct91 to #iqct9
            $("#ittkxs1, #iqct9").text(formattedPrice);
          }
        }
      }

      // Observer for mutation
      const targetNode = document.getElementById("iz3b4l");
      if (targetNode) {
        const config = {
          childList: true, subtree: true, characterData: true
        };
        const observer = new MutationObserver(() => {
          applyDiscount();
        });
        observer.observe(targetNode, config);
      }

      // Also reapply discount on currency change
      $("#currencyId").on("change", function () {
        applyDiscount();
      });
    </script>

    <script>
      // ✅ IMPROVED: Enhanced handleInputToggle with proper error handling
      function handleInputToggle() {
        // Get elements with null checks
        // ✅ FIX: Changed isa7ib1 to isa7ib
        const input1Element = document.getElementById("isa7ib");
        const input2Element = document.getElementById("i8skgo");

        if (!input1Element || !input2Element) {
          console.warn('Required input elements not found for handleInputToggle');
          return;
        }

        const input1 = input1Element.value.trim();
        const input2 = input2Element.value.trim();

        // Get all target elements
        const elements = {
          show: [
            document.getElementById("id31p4"),
            document.getElementById("irl1r"),
            document.getElementById("ittkxs1"),
            document.getElementById("i91pw6")
          ],
          hide: [
            document.getElementById("id31p4-2"),
            document.getElementById("io1dmo"),
            document.getElementById("i94rj"),
            document.getElementById("io76633")
          ]
        };

        // Check if all elements exist
        const allExist = [...elements.show, ...elements.hide].every(el => el !== null);
        if (!allExist) {
          console.warn('Some target elements not found in handleInputToggle');
          return;
        }

        if (input1 === "" && input2 === "") {
          elements.show.forEach(el => el.style.display = "block");
          elements.hide.forEach(el => el.style.display = "none");
        } else {
          elements.show.forEach(el => el.style.display = "none");
          elements.hide.forEach(el => el.style.display = "block");
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        // ✅ FIX: Changed isa7ib1 to isa7ib
        const inputA = document.getElementById("isa7ib");
        const inputB = document.getElementById("i8skgo");

        if (inputA) {
          inputA.oninput = handleInputToggle;
        } else {
          console.warn('Input element #isa7ib not found');
        }

        if (inputB) {
          inputB.oninput = handleInputToggle;
        } else {
          console.warn('Input element #i8skgo not found');
        }
      });
    </script>

    <!-- All other scripts remain the same -->

  </body>
</html>
