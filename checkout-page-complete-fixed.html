<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
      charset="utf-8"
    />

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Simple check: if page is already fully loaded, no loader needed
        if (document.readyState === 'complete') {
          return; // Page is already fully loaded, exit early
        }

        // If page is still loading, show loader until it's complete
        function getScrollbarWidth() {
          return window.innerWidth - document.documentElement.clientWidth;
        }

        function lockScroll() {
          const scrollbarWidth = getScrollbarWidth();
          document.body.style.overflow = "hidden";
          document.body.style.paddingRight = scrollbarWidth + "px";
        }

        function unlockScroll() {
          document.body.style.overflow = "unset";
          document.body.style.paddingRight = "";
        }

        function createLoader() {
          // Style block
          const style = document.createElement("style");
          style.textContent = `
              #custom-loader {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: #fff;
                z-index: 9999;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
              }

              .page-loader-spinner {
                width: 80px;
                height: 80px;
                border: 10px solid rgba(0, 0, 0, 0.1);
                border-top-color: white;
                border-radius: 50%;
                animation: pageloadspin 1s linear infinite;
                margin-bottom: 20px;
              }

              @keyframes pageloadspin {
                to { transform: rotate(360deg); }
              }
            `;
          document.head.appendChild(style);

          // Loader HTML
          const loader = document.createElement("div");
          loader.id = "custom-loader";
          loader.innerHTML = `<div class="page-loader-spinner"></div>`;
          loader.style.display = "flex";

          // Insert after #checkout-app
          document.body.insertAdjacentElement('afterend', loader);

          return loader;
        }

        function checkAllResourcesLoaded() {
          // Check if all images are loaded
          const images = document.querySelectorAll('img');
          const allImagesLoaded = Array.from(images).every(img => img.complete && img.naturalHeight !== 0);

          // Check if all stylesheets are loaded
          const stylesheets = document.querySelectorAll('link[rel="stylesheet"]');
          const allStylesLoaded = Array.from(stylesheets).every(link => {
            // Check if stylesheet is loaded by testing if it has a sheet property
            return link.sheet !== null || link.href === '';
          });

          // Check document ready state
          const documentReady = document.readyState === 'complete';

          return allImagesLoaded && allStylesLoaded && documentReady;
        }

        function waitForAllResources(loader) {
          const checkInterval = setInterval(function () {
            if (checkAllResourcesLoaded()) {
              clearInterval(checkInterval);
              setTimeout(function () {
                loader.remove();
                unlockScroll();
                document.body.style.display = '';
              }, 2500);
            }
          }, 100); // Check every 100ms

          // Fallback timeout - remove loader after 10 seconds regardless
          setTimeout(function () {
            clearInterval(checkInterval);
            loader.remove();
            unlockScroll();
            document.body.style.display = '';
          }, 10000);
        }

        // Create and show loader
        lockScroll();
        const loader = createLoader();

        // Start checking for all resources to be loaded
        waitForAllResources(loader);
      });
    </script>
    <script ecommerce-type="extend-native-history-api">
      (() => { const e = history.pushState, t = history.replaceState, a = history.back, r = history.forward; function n() { window.postMessage({ _custom_type_: "CUSTOM_ON_URL_CHANGED" }) } history.pushState = function () { e.apply(history, arguments), n() }, history.replaceState = function () { t.apply(history, arguments), n() }, history.back = function () { a.apply(history, arguments), n() }, history.forward = function () { r.apply(history, arguments), n() } })()
    </script>
    <title>TwinklingTree - Checkout</title>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,600,700,800,900&amp;display=swap"
      rel="stylesheet"
      cc="true"
      as="style"
      onload="this.rel='stylesheet'"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    />
    <style>
      body {
        font-family: 'Roboto', sans-serif;
        background-color: #f5f5f5;
      }
      .checkout-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      .section-title {
        font-size: 18px;
        font-weight: 600;
        margin-top: 30px;
        margin-bottom: 15px;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      .input-field {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
      }
      .price-display {
        font-size: 24px;
        font-weight: bold;
        color: #28a745;
        margin: 10px 0;
      }
      .hidden-section {
        display: none;
      }
      .shipping-insurance-container {
        background-color: #fff3cd;
        padding: 15px;
        border-left: 4px solid #ffc107;
        margin: 15px 0;
        border-radius: 4px;
      }
      .remove-text1 {
        color: #dc3545;
        cursor: pointer;
        text-decoration: underline;
        font-size: 12px;
      }
      .remove-text1:hover {
        text-decoration: none;
      }
      .button-group {
        margin-top: 20px;
      }
      .btn-primary {
        background-color: #007bff;
        border: none;
        padding: 12px 30px;
        font-size: 16px;
        border-radius: 4px;
        cursor: pointer;
      }
      .btn-primary:hover {
        background-color: #0056b3;
      }
      .currency-selector {
        width: 120px;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      .discount-code-section {
        background-color: #e7f3ff;
        padding: 15px;
        border-radius: 4px;
        margin: 15px 0;
      }
    </style>
  </head>
  <body data-new-gr-c-s-check-loaded="14.1264.0" data-gr-ext-installed="">
    <div class="checkout-container">
      <h1>TwinklingTree Checkout</h1>

      <!-- Currency Selection -->
      <div class="form-group">
        <label for="currencyId">Currency:</label>
        <select id="currencyId" class="currency-selector">
          <option value="USD">USD</option>
          <option value="CAD">CAD</option>
          <option value="EUR">EUR</option>
          <option value="AUD">AUD</option>
          <option value="GBP">GBP</option>
        </select>
      </div>

      <!-- Cart Summary Section -->
      <div class="section-title">Order Summary</div>
      <div id="id31p4" class="price-display">$99.99</div>
      <div id="irl1r" class="price-display">Subtotal: $99.99</div>
      <div id="ittkxs1" class="price-display">Total: $99.99</div>

      <!-- Alternative Total Display -->
      <div id="id31p4-2" class="hidden-section price-display">$89.99</div>
      <div id="io1dmo" class="hidden-section price-display">Subtotal: $89.99</div>
      <div id="i94rj" class="hidden-section price-display">Discounted Total: $89.99</div>
      <div id="io76633" class="hidden-section price-display">Final Price: $89.99</div>

      <!-- Price Display (Mobile) -->
      <div id="i91pw6" class="price-display" price="99.99">$99.99</div>
      <div id="iqct9" class="price-display">Total: $99.99</div>

      <!-- Discount Code Section -->
      <div class="section-title">Apply Discount Code</div>
      <div class="discount-code-section">
        <div class="form-group">
          <label for="isa7ib">Discount Code:</label>
          <input type="text" id="isa7ib" class="input-field" placeholder="Enter discount code">
        </div>
        <div class="form-group">
          <label for="i8skgo">Promo Code:</label>
          <input type="text" id="i8skgo" class="input-field" placeholder="Enter promo code">
        </div>
        <div id="iz3b4l">
          <div id="it2wo7">0</div>
        </div>
      </div>

      <!-- Shipping & Insurance Section -->
      <div class="section-title">Shipping Options</div>
      <div class="form-group">
        <label>
          <input type="checkbox" id="iczym6"> Add Shipping Insurance (+$5.00)
        </label>
      </div>

      <div class="shipping-insurance-container">
        <p>Protect your order with shipping insurance. Coverage includes loss, theft, and damage during transit.</p>
        <p>
          Cost: <strong>$5.00</strong>
          <span class="remove-text1">Remove</span>
        </p>
      </div>

      <!-- Shipping Methods -->
      <div class="form-group">
        <label>Shipping Method:</label>
        <div>
          <label><input type="radio" name="shipping" value="standard"> Standard Shipping (5-7 business days) - Free</label>
        </div>
        <div>
          <label><input type="radio" name="shipping" value="express"> Express Shipping (2-3 business days) - $15.00</label>
        </div>
        <div>
          <label><input type="radio" name="shipping" value="overnight"> Overnight Shipping - $25.00</label>
        </div>
      </div>

      <!-- Billing Address Section -->
      <div class="section-title">Billing Address</div>
      <div class="form-group">
        <label for="billing-name">Full Name:</label>
        <input type="text" id="billing-name" class="input-field" placeholder="John Doe">
      </div>
      <div class="form-group">
        <label for="billing-address">Street Address:</label>
        <input type="text" id="billing-address" class="input-field" placeholder="123 Main Street">
      </div>
      <div class="form-group">
        <label for="billing-city">City:</label>
        <input type="text" id="billing-city" class="input-field" placeholder="New York">
      </div>
      <div class="form-group">
        <label for="billing-state">State/Province:</label>
        <input type="text" id="billing-state" class="input-field" placeholder="NY">
      </div>
      <div class="form-group">
        <label for="billing-zip">ZIP/Postal Code:</label>
        <input type="text" id="billing-zip" class="input-field" placeholder="10001">
      </div>
      <div class="form-group">
        <label for="billing-country">Country:</label>
        <input type="text" id="billing-country" class="input-field" placeholder="United States">
      </div>

      <!-- Payment Section -->
      <div class="section-title">Payment Information</div>
      <div class="form-group">
        <label for="cardname">Cardholder Name:</label>
        <input type="text" id="cardname" class="input-field" placeholder="John Doe">
      </div>
      <div class="form-group">
        <label for="cardnumber">Card Number:</label>
        <input type="text" id="cardnumber" class="input-field" placeholder="1234 5678 9012 3456" maxlength="19">
      </div>
      <div class="form-group">
        <div style="display: flex; gap: 20px;">
          <div style="flex: 1;">
            <label for="expdate">Expiration Date:</label>
            <input type="text" id="expdate" class="input-field" placeholder="MM/YY" maxlength="5">
          </div>
          <div style="flex: 1;">
            <label for="cvv">CVV:</label>
            <input type="text" id="cvv" class="input-field" placeholder="123" maxlength="4">
          </div>
        </div>
      </div>

      <!-- Order Review -->
      <div class="section-title">Order Review</div>
      <div style="background-color: #f9f9f9; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
        <p><strong>Items:</strong> Product Name x 1</p>
        <p><strong>Subtotal:</strong> $99.99</p>
        <p><strong>Shipping:</strong> Free</p>
        <p><strong>Insurance:</strong> $0.00</p>
        <p style="font-size: 18px; font-weight: bold;"><strong>Order Total:</strong> <span id="iqct9-mobile">$99.99</span></p>
      </div>

      <!-- Buttons -->
      <div class="button-group">
        <button type="button" class="btn-primary" onclick="submitOrder()">Place Order</button>
        <button type="button" class="btn-primary" style="background-color: #6c757d; margin-left: 10px;" onclick="goBack()">Back to Cart</button>
      </div>
    </div>

    <!-- jQuery and Bootstrap Scripts -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

    <!-- FIX 4: Checkbox click handler with null check -->
    <script>
      $(document).ready(function () {
        // When clicking the remove-text class
        $('.remove-text1').click(function () {
          // Hide the shipping-insurance-container
          $('.shipping-insurance-container').hide();
          // FIX 4: Added null check before clicking checkbox
          const checkbox = document.getElementById('iczym6');
          if (checkbox) {
            checkbox.click();
          } else {
            console.warn('Checkbox #iczym6 not found');
          }
        });

        // When the checkbox is clicked
        $('#iczym6').click(function () {
          // Show/hide container based on checkbox state
          if ($(this).is(':checked')) {
            $('.shipping-insurance-container').show();
          } else {
            $('.shipping-insurance-container').hide();
          }
        });
      });
    </script>

    <!-- FIX 3 & Discount Logic -->
    <script>
      function getCurrencySymbol(currencyCode) {
        const symbols = {
          USD: "$",
          CAD: "CA$",
          EUR: "€",
          AUD: "AU$",
          GBP: "£"
        };
        return symbols[currencyCode] || "$";
      }

      function applyDiscount() {
        const selectedCurrency = $("#currencyId").val();
        const currencySymbol = getCurrencySymbol(selectedCurrency);
        const discountText = $.trim($("#it2wo7").text());
        const discount = parseFloat(discountText.replace(/[^0-9.]/g, ""));
        const priceElement = $("#i91pw6");

        if (discount > 0) {
          let originalPrice = 0;
          if (!priceElement.attr("price")) {
            originalPrice = parseFloat($.trim(priceElement.text()).replace(/[^0-9.]/g, ""));
            priceElement.attr("price", originalPrice);
          } else {
            originalPrice = parseFloat(priceElement.attr("price"));
          }
          const discountedPrice = (originalPrice - discount).toFixed(2);
          priceElement.text(currencySymbol + discountedPrice);
          // FIX 3: Changed #iqct91 to #iqct9
          $("#ittkxs1, #iqct9").text(currencySymbol + discountedPrice);
        } else {
          if (priceElement.attr("price")) {
            const originalPrice = parseFloat(priceElement.attr("price"));
            const formattedPrice = currencySymbol + originalPrice.toFixed(2);
            // FIX 3: Changed #iqct91 to #iqct9
            $("#ittkxs1, #iqct9").text(formattedPrice);
          }
        }
      }

      // Observer for mutation
      const targetNode = document.getElementById("iz3b4l");
      if (targetNode) {
        const config = {
          childList: true, subtree: true, characterData: true
        };
        const observer = new MutationObserver(() => {
          applyDiscount();
        });
        observer.observe(targetNode, config);
      }

      // Also reapply discount on currency change
      $("#currencyId").on("change", function () {
        applyDiscount();
      });
    </script>

    <!-- FIX 1, 2, 5, & 6: Enhanced handleInputToggle with proper error handling and event listeners -->
    <script>
      // FIX 5: Improved handleInputToggle function with comprehensive null checks and error handling
      function handleInputToggle() {
        // Get elements with null checks
        // FIX 1 & 2: Changed isa7ib1 to isa7ib
        const input1Element = document.getElementById("isa7ib");
        const input2Element = document.getElementById("i8skgo");

        if (!input1Element || !input2Element) {
          console.warn('Required input elements not found for handleInputToggle');
          return;
        }

        const input1 = input1Element.value.trim();
        const input2 = input2Element.value.trim();

        // Get all target elements
        const elements = {
          show: [
            document.getElementById("id31p4"),
            document.getElementById("irl1r"),
            document.getElementById("ittkxs1"),
            document.getElementById("i91pw6")
          ],
          hide: [
            document.getElementById("id31p4-2"),
            document.getElementById("io1dmo"),
            document.getElementById("i94rj"),
            document.getElementById("io76633")
          ]
        };

        // Check if all elements exist
        const allExist = [...elements.show, ...elements.hide].every(el => el !== null);
        if (!allExist) {
          console.warn('Some target elements not found in handleInputToggle');
          return;
        }

        if (input1 === "" && input2 === "") {
          elements.show.forEach(el => el.style.display = "block");
          elements.hide.forEach(el => el.style.display = "none");
        } else {
          elements.show.forEach(el => el.style.display = "none");
          elements.hide.forEach(el => el.style.display = "block");
        }
      }

      // FIX 6: Event listener setup with console warnings for missing elements
      document.addEventListener("DOMContentLoaded", function () {
        // FIX 2: Changed isa7ib1 to isa7ib
        const inputA = document.getElementById("isa7ib");
        const inputB = document.getElementById("i8skgo");

        if (inputA) {
          inputA.oninput = handleInputToggle;
        } else {
          console.warn('Input element #isa7ib not found');
        }

        if (inputB) {
          inputB.oninput = handleInputToggle;
        } else {
          console.warn('Input element #i8skgo not found');
        }
      });
    </script>

    <!-- Additional utility functions -->
    <script>
      function submitOrder() {
        alert('Order submitted successfully!');
        console.log('Order submission initiated');
      }

      function goBack() {
        window.history.back();
      }
    </script>
  </body>
</html>
